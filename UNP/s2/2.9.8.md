# 2.9.8 TCP_MAXSEG
***

&emsp;&emsp;
这个选项允许获取和设置 TCP 连接的最大分节大小 (MSS)。
TCP 连接建立之前双方就会交换各自的 MSS，然后选择最小的 MSS 作为本次连接的 MSS，为的就是尽可能地减少分片。
在 TCP 建立之前，使用 TCP\_MAXSEG 获得的 MSS 是系统默认值 (虽然系统默认值为 536，但是实际发送的 MSS 还是 1460，这点可以从 tcpdump 中观察到)，建立之后的 MSS 是双方较小的 MSS。
之前说过 MSS 取决于路径 MTU，如果路由发生变化造成路径 MTU 发生变化，那么 MSS 也可能发生改变。

&emsp;&emsp;
@todo: TCP\_MAXSEG默认值是 536，但是实际连接发现交换还是按照 1460 来进行交换。
以及如何侦测路径 MTU。

&emsp;&emsp;
路径 MTU 发现实现上并不复杂，原理上只需要在 IP 首部加上 DF 标记 (donnot-fragment 不要分片)，然后按照一个小的 MTU 对应 MSS 进行传输。
如果路径上 MTU 小于这次传输数据，会返回一个 ICMP 错误。
原理上通过这种反馈的方式就可以得到路径 MTU。
但是因为路径 MTU 取决于 IP 报文路由选择的路径，所以这是一个动态变化值，路径 MTU 也必须不断地进行修改和调整。