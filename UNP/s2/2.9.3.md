# SO_KEEPALIVE
***

&emsp;&emsp;
客户端连接服务端之后如果客户端宕机，服务端不知道客户端已经宕机继续维持连接，称这种情况为半开连接 (half-open connection)。
如果服务端不检测出半开连接就会维持连接最终耗尽资源。
当然在应用层服务端可自己来进行这个保活 (keepalive) 机制的实现，但是 TCP 内部也自带这样的机制。
如果设置了这个选项，一段时间内套接字任一方向没有数据交换，TCP 会自动给对端发送保持存活探测分节 (keep-alive probe)，这个分节对端必须相应，结果会有三种情况：

+ 响应 ACK，对端存活
+ 响应 RST，对端可能已经崩溃重启，so\_error 置为 ECONNRESET
+ 对端没有响应，那么按照 TCP 重传机制重传，最终错误可能为 ETIMEOUT (超时)，ENETUNREACH (路由错误)

&emsp;&emsp;
如果产生错误并且使用 IO 复用/信号驱动 IO，可以立刻检测到并且进行响应处理。
