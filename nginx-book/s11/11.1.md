# 概述
***

&emsp;&emsp;
nginx 启动阶段指从 nginx 初始化直至准备好按最新配置提供服务的过程。

&emsp;&emsp;
在不考虑 nginx 单进程工作的情况下，这个过程包含三种方式：

+ 启动新的 nginx
+ reload 配置
+ 热替换 nginx 代码

&emsp;&emsp;
三种方式有共同的流程，下面这幅图展现了这个流程：

&emsp;&emsp;
(图11-1 缺失)

&emsp;&emsp;
流程的开端是解析 nginx 配置、初始化模块，接着是初始化文件句柄，初始化共享内存，然后是监听端口，再后来创建 worker 子进程和其他辅助子进程，最后是 worker 初始化事件机制。
以上步骤结束以后，nginx 各个子进程开始各司其职，比如 worker 进程开始 accept 请求并按最新配置处理请求，cache-manager 进程开始管理 cache 文件目录等等。

&emsp;&emsp;
除了这些共同流程，这三种方式的差异也非常明显。
第一种方式包含命令行解析的过程，同时输出有一段时间是输出到控制台。
reload 配置有两种形式，一种是使用 nginx 命令行，一种是向 master 进程发送 HUP 信号，前者表面上与第一种方式无异，但实际上差别很大，后者则完全不支持控制台输出，无法直接查看 nginx 的启动情况。
而且 reload 配置时，nginx 需要自动停止以往生成的子进程，所以还包含复杂的进程管理操作，这一点在启动新的 nginx 的方式中是不存在的。
热替换 nginx 代码虽然使用上与 reload 配置的后一种形式相似，但在解析 nginx 配置方面与 reload 配置的方式差距非常大。
另外热替换 nginx 代码时，对以往创建的子进程管理也不像 reload 配置那样需要手工触发进行。
所以想弄懂 nginx 的启动阶段就必须理解所有这三种方式下 nginx 都是如何工作的。