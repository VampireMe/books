# 主要功能介绍
***

&emsp;&emsp;
响应的主体内容就存于单链表 in，链表一般不会太长，有时 in 参数可能为 NULL。
in 中存有 buf 结构体中，对于静态文件，这个 buf 大小默认是 32K；
对于反向代理的应用，这个 buf 可能是 4k 或者 8k。
为了保持内存的低消耗，nginx 一般不会分配过大的内存，处理的原则是收到一定的数据，就发送出去。
一个简单的例子，可以看看 nginx 的 chunked_filter 模块，在没有 content-length 的情况下，chunk 模块可以流式（ stream ）的加上长度，方便浏览器接收和显示内容。

&emsp;&emsp;
在响应体过滤模块中，尤其要注意的是 buf 的标志位，完整描述可以在“相关结构体”这个节中看到。
如果 buf 中包含 last 标志，说明是最后一块 buf，可以直接输出并结束请求了。
如果有 flush 标志，说明这块 buf 需要马上输出，不能缓存。
如果整块 buffer 经过处理完以后没有数据了，可以把 buffer 的 sync 标志置上，表示只是同步的用处。

&emsp;&emsp;
当所有的过滤模块都处理完毕时，在最后的 write_fitler 模块中，nginx 会将 in 输出链拷贝到 r->out 输出链的末尾，然后调用 sendfile 或者 writev 接口输出。
由于 nginx 是非阻塞的 socket 接口，写操作并不一定会成功，可能会有部分数据还残存在 r->out。
在下次的调用中 nginx 会继续尝试发送，直至成功。