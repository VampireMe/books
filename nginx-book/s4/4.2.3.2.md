# 4.2.3.2 发出子请求
***

&emsp;&emsp;
Nginx 过滤模块一大特色就是可以发出子请求，也就是在过滤响应内容时可以发送新的请求，Nginx 会根据调用的先后顺序将多个回复的内容拼接成正常的响应主体。
一个简单的例子可以参考 addition 模块。

&emsp;&emsp;
Nginx 是如何保证父请求和子请求的顺序呢？
当 Nginx 发出子请求时就会调用 ngx\_http\_subrequest 函数，将子请求插入父请求的 r->postponed 链表中。
子请求会在主请求执行完毕时获得依次调用。
子请求同样会有一个请求所有的生存期和处理过程，也会进入过滤模块流程。

&emsp;&emsp;
关键点是在 postpone\_filter 模块中，它会拼接主请求和子请求的响应内容。
r->postponed 按次序保存有父请求和子请求，它是一个链表，如果前面一个请求未完成，那后一个请求内容就不会输出。
当前一个请求完成时并输出时后一个请求才可输出，当所有的子请求都完成时，所有的响应内容也就输出完毕了。