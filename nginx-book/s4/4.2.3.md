# 响应体过滤函数
***

&emsp;&emsp;
响应体过滤函数是过滤响应主体的函数。
ngx_http_top_body_filter 这个函数每个请求可能会被执行多次，它的入口函数是 ngx_http_output_filter，比如：

    ngx_int_t
    ngx_http_output_filter(ngx_http_request_t *r, ngx_chain_t *in) {
        ngx_int_t          rc;
        ngx_connection_t  *c;

        c = r->connection;

        rc = ngx_http_top_body_filter(r, in);

        if (rc == NGX_ERROR) {
            /* NGX_ERROR may be returned by any filter */
            c->error = 1;
        }

        return rc;
    }

&emsp;&emsp;
ngx_http_output_filter 可以被一般的静态处理模块调用，也有可能是在 upstream 模块里面被调用，对于整个请求的处理阶段来说它们处于的用处都是一样的，就是把响应内容过滤，然后发给客户端。

&emsp;&emsp;
具体模块的响应体过滤函数的格式类似这样：

static int
ngx_http_example_body_filter(ngx_http_request_t *r, ngx_chain_t *in) {
    ...
    return ngx_http_next_body_filter(r, in);
}

&emsp;&emsp;
该函数的返回值一般是 NGX_OK，NGX_ERROR 和 NGX_AGAIN，分别表示处理成功，失败和未完成。