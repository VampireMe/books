# 2.2.2.2 pipe
***

&emsp;&emsp;
在 http 1.1 中引入了一种新的特性，即 pipeline。
什么是 pipeline 呢？
pipeline 其实就是流水线作业，它可以看作为 keepalive 的一种升华，因为 pipeline 也是基于长连接的，目的就是利用一个连接做多次请求。
如果客户端要提交多个请求，对于 keepalive 第二个请求必须要等到第一个请求的响应接收完全后才能发起，这和 TCP 的停止等待协议是一样的，得到两个响应的时间至少为 2 x RTT (Round-Trip Time 往返延时)。
而对 pipeline，客户端不必等到第一个请求处理完后就可以马上发起第二个请求，得到两个响应的时间可能能够达到 1 x RTT。
Nginx 是直接支持 pipeline 的，但是 Nginx 对 pipeline 中的多个请求的处理却不是并行的，依然是一个请求接一个请求的处理，只是在处理第一个请求的时候客户端就可以发起第二个请求。
这样 Nginx 利用 pipeline 减少了处理完一个请求后等待第二个请求的请求头数据的时间。
其实 Nginx 的做法很简单，前面说到 Nginx 在读取数据时会将读取的数据放到一个 buffer 里，如果 Nginx 在处理完前一个请求后发现 buffer 里还有数据，就认为剩下的数据是下一个请求的开始，然后就接下来处理下一个请求，否则就设置 keepalive。